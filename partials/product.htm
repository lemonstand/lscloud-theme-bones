<header>
  <h1>{{ product.name }}</h1>

  {% if product.short_description %}
  <section class="short-description">
    {{ product.short_description | unescape }}
  </section>
  {% endif %}
</header>

<main class="media-object">

  <section class="product-image media-object-section">
    <div class="orbit" data-orbit>

      <ul class="orbit-container">
        {% for image in product.images %}
        <li class="orbit-slide {% if loop.first %}is-active{% endif %}">
          <img
              class="orbit-image"
              src="{{ image.thumbnail('auto', 'auto') }}"
              alt="{{ image.description }}"
              title="{{ image.title }}" />
        </li>
        {% endfor %}
      </ul>

      <nav class="orbit-bullets">
        {% for index, image in product.images %}
        <button
            {% if loop.first %}class="is-active"{% endif %}
            data-slide="{{ index }}">
          <img
              class="orbit-image"
              src="{{ image.thumbnail('100', '100') }}"
              alt="{{ image.description }}"
              title="{{ image.title }}" />
        </button>
        {% endfor %}
      </nav>

    </div>
  </section>

  <section class="media-object-section main-section">
    <h2>{{ product.name }}</h2>

    <section class="product-prices">
      {% if product.onSale %}
        <p class="product-base-price">Reg. {{ product.base_price | currency }}</p>
      {% endif %}
      <p class="product-price">{{ product.price ? (product.price | currency) : 'Free' }}</p>
    </section>

    <section class="description">
      {{ product.description | unescape }}
    </section>

    {% if theme.enableReviews %}
      <section class="ratings">
        {{ partial('ratings', {rating: product.rating()}) }}
      </section>

      <section class="reviews">
        {{ partial('reviews', {
          product: product,
          reviews: product.reviews()})
        }}
      </section>
    {% endif %}

    {% if product.productAttributes.count %}
    <table class="product-attributes">
      {% for attribute in product.productAttributes %}
      <tr>
        <th>{{ attribute.name }}</th>
        <td>{{ attribute.value }}</td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}

    <section class="product-form">
      {{ open_form({
          'data-ajax-handler': 'shop:onAddToCart',
          'data-ajax-update': '.mini-cart=mini-cart,.cart-count=cart-count',
          'method': 'post'
         })
      }}
        {% for option in product.options %}
        <label>
          {{ option.name }}
          <select name="options[{{ option.id }}]">
            {% for key, value in option.values %}
            <option
                value="{{ key }}"
                {{ option_state(postedOptions[option.id], key) }}>
              {{ value }}
            </option>
            {% endfor %}
          </select>
        </label>
        {% endfor %}

        {% if product.extras.count %}
        {% for extra in product.extras %}
        <label class="extra">
          {{ extra.name }}
          <span class="price">({{ extra.price | currency }})</span>
          <input
              type="checkbox"
              {{ checkbox_state(postedExtras[extra.id], extra.id) }}
              name="extras[{{ extra.id }}]"
              {% if not extra.enabled %}
              disabled
              {% endif %}>
          <span class="error"></span>
        </label>
        {% endfor %}
        {% endif %}

        {% if not product.track_inventory or
             (product.in_stock_amount != "Out Of Stock" and
                product.in_stock_amount > product.out_of_stock_threshold) %}

             <label>
          Quantity
          <input type="number" name="quantity" value="1" min="1" required>
        </label>

        <input type="hidden" name="productId" value="{{ product.id }}">
        <button class="button" type="submit">Add to cart</button>

        {% else %}

        <div class="callout primary">
          <h4>This product is currently out of stock.</h4>
          <p>Check back for more {{ product.expected_availability_date | default('soon') }}.</p>
        </div>

        {% endif %}
      {{ close_form() }}
    </section>

    {% if product.priceTiers|length %}
    <section class="price-tiers">
      <h2>Bulk Pricing</h2>
      <table>
        <thead>
        <tr>
          <td>Quantity</td>
          <td>Price</td>
        </tr>
        </thead>
        <tbody>
        {% for tier in product.priceTiers %}
        <tr>
          <td>{{ tier.quantity }}</td>
          <td>{{ tier.price | currency}}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </section>
    {% endif %}
  </section>

</main>

<section>
  {% if product.crossSells | length %}
  <section class="cell cross-sells">
    <div class="grid-x grid-padding-x">
      <div class="cell related-header">
        <h2>You May Be Interested in These</h2>
      </div>
      {{ open_form({
          'data-ajax-handler': 'shop:onAddToCart',
          'data-ajax-update': '.mini-cart=mini-cart,.cart-count=cart-count',
          'method': 'post'
        })
      }}
        {{ partial('related-products', { relatedProducts: product.crossSells }) }}
      {{ close_form() }}
    </div>
  </section>
  {% endif %}
  {% if product.upSells | length %}
  <section class="cell upsells">
    <div class="grid-x grid-padding-x">
      <div class="cell related-header">
        <h2>Purchase Together and Save</h2>
      </div>
      {{ open_form({
        'data-ajax-handler': 'shop:onAddToCart',
        'data-ajax-update': '.mini-cart=mini-cart,.cart-count=cart-count',
        'method': 'post'
      })
    }}
      {{ partial('related-products', { relatedProducts: product.upSells }) }}
    {{ close_form() }}
    </div>
  </section>
  {% endif %}

</section>
